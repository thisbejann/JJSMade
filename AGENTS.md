# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

JJSMade is a single-user business management web app for a replica item reselling operation (CN sellers → PH market). It tracks the full item lifecycle: order placement, QC photo review, international shipping, local delivery, sale, and profit calculation. There is no authentication — it's an internal operations dashboard.

## Commands

- **Dev server:** `npm run dev` (Vite on port 5173)
- **Convex backend:** `npx convex dev` (must run simultaneously with Vite in a separate terminal)
- **Build:** `npm run build` (runs `tsc -b && vite build`)
- **Type check:** `npx tsc --noEmit` (frontend only; Convex has its own tsconfig)
- **Lint:** `npm run lint`
- **Preview production build:** `npm run preview`

Both `npm run dev` and `npx convex dev` must be running together for the app to work.

## Architecture

### Tech Stack

React 19 + Vite 7 + Convex (BaaS) + Tailwind CSS 4 + TypeScript 5 + Recharts + Framer Motion + Lucide React

### Two-Project Structure

The repo has two separate TypeScript projects with independent tsconfigs:

- **`src/`** — React frontend (`tsconfig.app.json`, bundler module resolution)
- **`convex/`** — Convex server functions (`convex/tsconfig.json`, ESNext target)

These share types via `convex/_generated/` (auto-generated by `npx convex dev`). Frontend code imports from `convex/_generated/api` and `convex/_generated/dataModel` for type-safe API references and document types (`Doc<"items">`, `Id<"items">`).

### Convex Backend (`convex/`)

Three tables: `items`, `sellers`, `settings` (schema in `convex/schema.ts`).

**Key pattern — server-side computed fields:** Monetary fields (`pricePHP`, `localShippingPHP`, `forwarderFee`, `totalCost`, `profit`) are stored on the document, not computed at read time. The shared `computeDerivedFields()` in `convex/helpers.ts` handles all calculations. Every mutation that modifies pricing inputs must call this and persist the results.

**Exchange rate snapshotting:** Each item stores `exchangeRateUsed` at creation time. Changing the global rate in settings does not affect existing items.

**Convex files:**

- `items.ts` — CRUD mutations + listing/filtering queries (the core of the app)
- `analytics.ts` — 10 aggregation queries (all do in-JS aggregation, no GROUP BY)
- `sellers.ts` — CRUD + list with computed stats (joins items by seller name)
- `settings.ts` — Single-document pattern (get, initialize, update)
- `storage.ts` — QC photo upload URL generation and retrieval

### Frontend (`src/`)

**Tailwind v4** — uses CSS-first `@theme {}` blocks in `src/index.css`, NOT `tailwind.config.js`. The Vite plugin is `@tailwindcss/vite`.

**Design system** — Premium dark theme with gold accents. All design tokens are in `src/index.css` under `@theme`. Key color layers: `base` (#08080a) → `surface` (#111114) → `elevated` (#1a1a1f) → `hover` (#222228). Accent is gold (#e8a820). Three font families: `font-display` (Clash Display), `font-body` (General Sans), `font-mono` (JetBrains Mono).

**Routing** — React Router v7 (`react-router` package, not `react-router-dom`). Declarative routes in `App.tsx` wrapped in `AppLayout` which provides sidebar + topbar.

**Component layers:**

- `components/ui/` — Generic primitives (Button, Input, Card, Modal, etc.)
- `components/layout/` — App shell (Sidebar, TopBar, AppLayout, PageContainer)
- `components/items/` — Domain components (ItemForm, ItemTable, StatusTimeline, etc.)
- `components/sellers/` — Seller-specific components
- `components/dashboard/` — Dashboard widgets (StatCard, RecentOrders, PendingQcSection)
- `components/charts/` — All Recharts-based chart components
- `pages/` — Route-level page components

**Key shared modules:**

- `lib/constants.ts` — All status/QC/category config objects and TypeScript types
- `lib/formatters.ts` — Currency (`formatPHP`, `formatCNY`) and date formatting
- `lib/utils.ts` — `cn()` helper (clsx + tailwind-merge)
- `lib/chartTheme.ts` — Shared Recharts dark theme colors and tooltip styles
- `hooks/useSettings.ts` — Settings query with auto-initialization
- `hooks/useComputedCosts.ts` — Client-side live cost/profit preview for forms

### Cost Calculation Flow

Costs are computed in two places:

1. **Client-side preview** (`useComputedCosts` hook) — updates live as the user fills the form
2. **Server-side persistence** (`computeDerivedFields` in Convex) — the mutation recomputes and stores all derived fields

Formula: `totalCost = pricePHP + localShippingPHP + forwarderFee + lalamoveFee`, `profit = sellingPrice - totalCost`

### Item Status Flow

`ordered → shipped_to_warehouse → at_cn_warehouse → shipped_to_ph → at_ph_warehouse → delivered_to_me → sold` (with `cancelled`/`returned` as terminal states from any point). Defined in `STATUS_FLOW` in `lib/constants.ts`.

### Git

- create a new branch named [`jannjaspher/branch-name`] for each feature, bugfix, or enhancement
- NEVER commit directly to `master`
- Open a PR against `master` when your work is ready for review
- NEVER auto-merge PRs; wait for user review and explicit merge approval
- Branch naming: `jannjaspher/<descriptive-name>` (e.g., `jannjaspher/add-transaction-form`)
- Commit often with clear messages

### Plan Mode

- Make the plan extremely concise. Sacrifice grammar for the sake of concision.
- At the end of each plan, give me a list of unresolved questions to answer, if any.
